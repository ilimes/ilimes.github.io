---
published: true
title: "React Query ì•Œì•„ë³´ê¸°"
excerpt: "ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ ì•Œì•„ë³´ê¸°"

categories:
  - React
tags:
  - [ë¦¬ì•¡íŠ¸, ë¦¬ì•¡íŠ¸ì¿¼ë¦¬, reactquery]

# table of contents
toc: true
toc_sticky: true
---

### âœ”ï¸ React-Queryë€?

`React Query` ëŠ” ì„œë²„ì— ìˆë˜ ê°’ì„ í´ë¼ì´ì–¸íŠ¸ë¡œ ê°€ì ¸ì˜¤ê±°ë‚˜, ìºì‹± ë˜ëŠ” ë™ê¸°í™” ë“± ì¼ë ¨ì˜ ë¹„ë™ê¸° ê³¼ì •ë“¤ì„ í¸í•˜ê²Œ í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë¦¬ì•¡íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤.

### âœ”ï¸ React-Queryì˜ ì¥ì 

ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ í”„ë¡œì íŠ¸ êµ¬ì¡°ê°€ ë‹¨ìˆœí•´ì§€ê³ , í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì‹œ ê·€ì°®ì„ ìˆ˜ ìˆëŠ” ëª‡ê°€ì§€ ì¼ë“¤ì„ ìˆ˜í–‰í•´ì¤ë‹ˆë‹¤.

- íš¨ìœ¨ì ì¸ ìºì‹± ê´€ë¦¬
- ê°™ì€ ë°ì´í„°ì— ëŒ€í•˜ì—¬ ì—¬ëŸ¬ë²ˆì˜ ìš”ì²­ì´ ìˆì„ ì‹œ ì¤‘ë³µì„ ì œê±° (ì˜µì…˜ìœ¼ë¡œ ì¤‘ë³µ í˜¸ì¶œ í—ˆìš© ì‹œê°„ ì¡°ì ˆë„ ê°€ëŠ¥)
- ë°ì´í„°ê°€ ì˜¤ë˜ë˜ì—ˆì„ ê²½ìš° ì•Œì•„ì„œ ì—…ë°ì´íŠ¸ í•´ì¤Œ
- í˜ì´ì§• ì²˜ë¦¬ ì„±ëŠ¥ ìµœì í™”
- Reduxë¡œ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒ ë³´ë‹¤ ì½”ë“œ ë¶„ëŸ‰ì´ ì ìŒ

### âœ”ï¸ ì„¤ì¹˜í•˜ê¸°

ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ëŠ” npm ë˜ëŠ” yarnìœ¼ë¡œ ì†ì‰½ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
npm install react-query
yarn install react-query
```

### âœ”ï¸ React-Query ê¸°ë³¸ ì„¸íŒ…

```jsx
// src/index.js
import React from "react";
import ReactDOM from "react-dom";
import App from "./App";
import { QueryClient, QueryClientProvider } from "react-query";
import { ReactQueryDevtools } from "react-query/devtools";

const queryClient = new QueryClient();

ReactDOM.render(
  <React.StrictMode>
    <QueryClientProvider client={queryClient}>
      {/* devtools */}
      <ReactQueryDevtools initialIsOpen={true} />
      <App />
    </QueryClientProvider>
  </React.StrictMode>,
  document.getElementById("root")
);
```

### âœ”ï¸ Queries

```jsx
import { useQuery } from "react-query";

function App() {
  const info = useQuery("todos", fetchTodoList);
}
```

- `useQuery` ì˜ ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” unique keyë¥¼ ì…ë ¥í•©ë‹ˆë‹¤. ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” ë°ì´í„°ë¥¼ íŒ¨ì¹­í•˜ê¸° ìœ„í•œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤.
- ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ ì„¤ì •í•œ unique key ëŠ” ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ í•´ë‹¹ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜¸ì¶œí•˜ëŠ” ì‹ìœ¼ë¡œ í™œìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
- unique keyëŠ” Stringê³¼ Arrayë¥¼ ë°›ìŠµë‹ˆë‹¤.
- `useQuery` ëŠ” ë¹„ë™ê¸°ë¡œ ì‘ë™í•©ë‹ˆë‹¤.

#### useQuery return ê°’ì— í¬í•¨ëœ states

- `isLoading` or status === 'loading' : í˜„ì¬ ë°ì´í„°ë¥¼ ìš”ì²­ ì¤‘ì´ë‚˜ ì•„ì§ ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°
- `isError` or status === 'error': ì¿¼ë¦¬ì—ì„œ ì—ëŸ¬ê°€ ë‚¬ì„ ê²½ìš°
- `isSuccess` or status === 'success' - ì¿¼ë¦¬ ìš”ì²­ ì„±ê³µí•œ ê²½ìš°
- `isIdle` or status === 'idle': ì´ ì¿¼ë¦¬ëŠ” í˜„ì¬ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ ë•Œ ë‚˜ì˜´
- `isFetching` : ë°ì´í„° ìš”ì²­ ì¤‘ì¼ ë•ŒëŠ” (ë‚´ë¶€ì ìœ¼ë¡œ ë¦¬íŒ¨ì¹­ ì¤‘ ì¼ë•Œë„ í¬í•¨) í•­ìƒ Trueë¥¼ ë¦¬í„´í•œë‹¤

#### useQuery ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰

```jsx
const { data: todoList, error, isFetching } = useQuery("todos", fetchTodoList);
const {
  data: nextTodo,
  error,
  isFetching,
} = useQuery("nextTodos", fetchNextTodoList, {
  enabled: !!todoList, // trueê°€ ë˜ë©´ fetchNextTodoListë¥¼ ì‹¤í–‰í•œë‹¤
});
```

ìœ„ì™€ ê°™ì´ `enabled` ì˜µì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° useQueryë¥¼ ì‚¬ìš©í•  ë•Œ ë™ê¸°ì ìœ¼ë¡œ ì‚¬ìš©ê°€ëŠ¥í•˜ê²Œ í•´ì¤ë‹ˆë‹¤.

#### useQueries

```jsx
function App({ users }) {
  const userQueries = useQueries(
    users.map((user) => {
      return {
        queryKey: ["user", user.id],
        queryFn: () => fetchUserById(user.id),
      };
    })
  );
}
```

#### ì¿¼ë¦¬ ë¬´íš¨í™” ì‹œí‚¤ê¸°

```jsx
const { mutate } = useMutation(apis.update, {
  onSuccess: () => {
    queryClient.invalidateQueries("all"); //invalidateQueries(ë¬´íš¨í™” ì‹œí‚¬ queryKey ì´ë¦„)
    day_input.current.value = "";
    time_input.current.value = "";
  },
});
```

ìœ„ì™€ ê°™ì´ `invalidateQueries` ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ë°ì´í„°ê°€ ìµœì‹ ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆì„ ë•Œ ì´ì „ ë°ì´í„°ë¥¼ ë¬´íš¨í™” ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### âœ”ï¸ ì°¸ê³  ì‚¬ì´íŠ¸

<https://tanstack.com/query/v4/docs/guides/window-focus-refetching?from=reactQueryV3&original=https://react-query-v3.tanstack.com/guides/window-focus-refetching>

{:.notice--success}
ğŸ””**í¬ìŠ¤íŒ… ê³µì§€**  
ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ ì…ë‹ˆë‹¤.  
ì˜ëª»ëœ ë¶€ë¶„ì´ ìˆì„ ì‹œ ë©”ì¼ì´ë‚˜ ëŒ“ê¸€ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤ :)
