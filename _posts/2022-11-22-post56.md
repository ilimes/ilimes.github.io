---
published: true
title: "Intersection Observer API í™œìš©í•˜ì—¬ Reactì—ì„œ ë¬´í•œìŠ¤í¬ë¡¤ êµ¬í˜„í•˜ê¸°"
excerpt: "React ë¬´í•œìŠ¤í¬ë¡¤ (Infinite Scroll) êµ¬í˜„ "

categories:
  - React
tags:
  - [ë¬´í•œìŠ¤í¬ë¡¤, InfiniteScroll, ë¦¬ì•¡íŠ¸]

# table of contents
toc: true
toc_sticky: true
---

### âœ”ï¸ Infinite Scroll?

ë¬´í•œìŠ¤í¬ë¡¤(Infinite Scroll) ì´ë€ ë§ ê·¸ëŒ€ë¡œ ìŠ¤í¬ë¡¤ì„ ë¬´í•œìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ë§í•©ë‹ˆë‹¤. ë¶ˆëŸ¬ì™€ì•¼ í•˜ëŠ” ê²Œì‹œê¸€ ëª©ë¡ì´ ë§ì€ ê²½ìš° ë¬´í•œìŠ¤í¬ë¡¤ì„ í™œìš©í•˜ë©´ ì‚¬ìš©ì í¸ì˜ì„±ê³¼ í´ë¼ì´ì–¸íŠ¸ ë¶€ë‹´ì„ ëœ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.

### âœ”ï¸ Intersection Observer API ë€?

> Intersection Observer APIëŠ” íƒ€ê²Ÿ ìš”ì†Œì™€ ìƒìœ„ ìš”ì†Œ ë˜ëŠ” ìµœìƒìœ„ document ì˜ viewport ì‚¬ì´ì˜ intersection ë‚´ì˜ ë³€í™”ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê´€ì°°í•˜ëŠ” APIì…ë‹ˆë‹¤.

MDNì—ì„œëŠ” Intersection Observer APIë¥¼ ìœ„ì™€ ê°™ì´ ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì‰½ê²Œ ë§í•˜ë©´ ê´€ì°° ì¤‘ì¸ ìš”ì†Œê°€ ì‚¬ìš©ìê°€ ë³´ê³  ìˆëŠ” ì˜ì—­ ì•ˆì— ë“¤ì–´ì™”ëŠ”ì§€ ì•Œë ¤ì£¼ëŠ” APIë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### âœ”ï¸ Options

```jsx
const io = new IntersectionObserver(callback, options);
```

ì˜µì…˜ë¶€ì—ëŠ” root, rootMargin, threshold 3ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

- `root` : íƒ€ê²Ÿ ì—˜ë¦¬ë¨¼íŠ¸ê°€ ë³´ì´ëŠ”ì§€ ì•ˆë³´ì´ëŠ”ì§€ ê²°ì •í•  ë·°í¬íŠ¸ë¡œ ì‚¬ìš©ë˜ëŠ” ì—˜ë¦¬ë¨¼íŠ¸ (ê¸°ë³¸ê°’ì€ Browser Viewport)
- `rootMargin` : rootì— ì •ì˜ëœ Elementê°€ ê°€ì§„ ë§ˆì§„ê°’ (ê¸°ë³¸ê°’ì€ 0)
- `threshold` : íƒ€ê²Ÿ ì—˜ë¦¬ë¨¼íŠ¸ê°€ rootì— ì •ì˜ëœ Elementì— ì–¼ë§ˆë‚˜ ë…¸ì¶œë˜ì—ˆì„ ë•Œ Callback í•¨ìˆ˜ë¥¼ ì‹¤í–‰í• ì§€ ì •ì˜í•˜ëŠ” ì˜µì…˜ (ê¸°ë³¸ê°’ì€ 0)

```jsx
const io = new IntersectionObserver(callback, { threshold: 0.7 });
io.observe(ê´€ì°°í•  ìš”ì†Œ);
```

ì˜ˆë¥¼ ë“¤ì–´ ê´€ì°°í•˜ê³ ì í•˜ëŠ” ëŒ€ìƒì´ í™”ë©´ ë‚´ 70% ì•ˆì— ë“¤ì–´ì™”ì„ ê²½ìš° ìœ„ì™€ ê°™ì´ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### âœ”ï¸ ì½œë°±í•¨ìˆ˜

```jsx
const callback = (entries, io) => {
  entries.forEach((entry) => {
    // í™”ë©´ ì•ˆì— ìš”ì†Œê°€ ë“¤ì–´ì™”ëŠ”ì§€ ì²´í¬
    if (entry.isIntersecting) {
      // ê¸°ì¡´ ê´€ì°°í•˜ë˜ ìš”ì†ŒëŠ” ë” ì´ìƒ ê´€ì°°í•˜ì§€ ì•ŠìŒ
      io.unobserve(entry.target);
      // TODO: ìƒˆë¡œìš´ ì»¨í…ì¸  ì¶”ê°€
      // TODO: ìƒˆë¡œìš´ ì»¨í…ì¸ ì˜ ë§ˆì§€ë§‰ ìš”ì†Œë¥¼ ê´€ì°° ì‹œì‘
    }
  });
};
```

ì½œë°± í•¨ìˆ˜ëŠ” ìœ„ì™€ ê°™ì´ entriesì™€ ioë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ê°–ìŠµë‹ˆë‹¤.  
Intersection Observerë¥¼ ì“°ê¸° ì´ì „ì—ëŠ” ë¬´í•œìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•  ë•Œ ì„±ëŠ¥ ë¬¸ì œë¡œ ì¸í•´ `debounce` ë‚˜ `throttle` ê³¼ ê°™ì€ í˜¸ì¶œìˆ˜ ì œí•œ ìµœì í™” ì‘ì—…ì´ ë°˜ë“œì‹œ ì´ë¤„ì ¸ì•¼ í–ˆì§€ë§Œ ì§€ê¸ˆì€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### âœ”ï¸ ë¬´í•œìŠ¤í¬ë¡¤ êµ¬í˜„

ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ë¬´í•œìŠ¤í¬ë¡¤ êµ¬í˜„ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```jsx
$ npx create-react-app infinite-scroll-example
$ npm i styled-components react-loading
```

ìš°ì„  ìœ„ì™€ ê°™ì€ CRA ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ì´ˆê¸° ì„¸íŒ…ì„ í•˜ê³  styledì™€ react-loading ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

- Item.js

```jsx
import React from "react";
import styled from "styled-components";

const ItemWrap = styled.div`
  width: 350px;
  height: 370px;
  padding-top: 140px;
  font-size: 70px;
  display: flex;
  flex-direction: column;
  background-color: #ffffff;
  margin: 1rem;
  box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
  border-radius: 6px;
`;

const Item = ({ number }) => {
  return <ItemWrap>{number}</ItemWrap>;
};

export default Item;
```

- Loader.js => ë¡œë”© ìŠ¤í”¼ë„ˆ ì»´í¬ë„ŒíŠ¸

```jsx
import React from "react";
import ReactLoading from "react-loading";
import styled from "styled-components";

const LoaderWrap = styled.div`
  width: 100%;
  height: 80%;
  display: flex;
  justify-content: center;
  text-align: center;
  align-items: center;
`;

const Loader = () => {
  return (
    <LoaderWrap>
      <ReactLoading type="spin" color="#455560" />
    </LoaderWrap>
  );
};

export default Loader;
```

- App.js

```jsx
import React, { useEffect, useState } from "react";
import styled, { createGlobalStyle } from "styled-components";
import Item from "./Item";
import Loader from "./Loader";

const GlobalStyle = createGlobalStyle`
  *, *::before, *::after {
    box-sizing: border-box;
    padding: 0;
    margin: 0;
  }

  body {
    background-color: #f2f5f7;
  }
`;

const AppWrap = styled.div`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-align: center;
  align-items: center;

  .Target-Element {
    width: 100vw;
    height: 140px;
    display: flex;
    justify-content: center;
    text-align: center;
    align-items: center;
  }
`;

const App = () => {
  const [target, setTarget] = useState(null);
  const [isLoaded, setIsLoaded] = useState(false);
  const [itemLists, setItemLists] = useState([1]);

  useEffect(() => {
    console.log(itemLists);
  }, [itemLists]);

  const getMoreItem = async () => {
    setIsLoaded(true);
    await new Promise((resolve) => setTimeout(resolve, 1500));
    let Items = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
    setItemLists((itemLists) => itemLists.concat(Items));
    setIsLoaded(false);
  };

  const onIntersect = async ([entry], observer) => {
    if (entry.isIntersecting && !isLoaded) {
      observer.unobserve(entry.target);
      await getMoreItem();
      observer.observe(entry.target);
    }
  };

  useEffect(() => {
    let observer;
    if (target) {
      observer = new IntersectionObserver(onIntersect, {
        threshold: 0.4,
      });
      observer.observe(target);
    }
    return () => observer && observer.disconnect();
  }, [target]);

  return (
    <>
      <GlobalStyle />
      <AppWrap>
        {itemLists.map((v, i) => {
          return <Item number={i + 1} key={i} />;
        })}
        <div ref={setTarget} className="Target-Element">
          {isLoaded && <Loader />}
        </div>
      </AppWrap>
    </>
  );
};

export default App;
```

### âœ”ï¸ ì ìš© í™”ë©´

![Nov-22-2022 23-59-52](https://user-images.githubusercontent.com/95404736/203347423-fa5b0df0-e094-4726-a99a-0f4137145e35.gif)

### âœ”ï¸ ì°¸ê³  ì‚¬ì´íŠ¸

- <https://developer.mozilla.org/ko/docs/Web/API/Intersection_Observer_API>
- <https://velog.io/@yejinh/Intersection-Observer%EB%A1%9C-%EB%AC%B4%ED%95%9C-%EC%8A%A4%ED%81%AC%EB%A1%A4-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0>
- <https://velog.io/@jce1407/React-%EB%AC%B4%ED%95%9C-%EC%8A%A4%ED%81%AC%EB%A1%A4-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-with-Intersection-Observer>

{:.notice--success}
ğŸ””**í¬ìŠ¤íŒ… ê³µì§€**  
ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ ì…ë‹ˆë‹¤.  
ì˜ëª»ëœ ë¶€ë¶„ì´ ìˆì„ ì‹œ ë©”ì¼ì´ë‚˜ ëŒ“ê¸€ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤ :)
