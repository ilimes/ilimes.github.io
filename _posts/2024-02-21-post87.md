---
published: true
title: "Github Actionsë¥¼ í™œìš©í•œ CI/CD êµ¬ì¶• (OCI & SSH)"
excerpt: "Github Actionsë¥¼ í™œìš©í•˜ì—¬ ë°°í¬ìë™í™” êµ¬ì¶•"

categories:
  - DevOps
tags:
  - [Github Actions, OCI, CI/CD, ë°°í¬ìë™í™”]
header:
  teaser: https://github.com/user-attachments/assets/cf683b19-2848-465a-8374-27b124271f95

# table of contents
toc: true
toc_sticky: true
---

ì˜¤ëŠ˜ì€ ì§„í–‰í•˜ê³  ìˆëŠ” ì‚¬ì´ë“œ í”„ë¡œì íŠ¸ì— Github Actionsë¥¼ í™œìš©í•˜ì—¬ CI/CD êµ¬ì¶•ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤.  
CI/CDë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆëŠ” íˆ´ì€ ë¬´ë£Œë²„ì „ ë˜ëŠ” ê¸°ì—…ìš© ìœ ë£Œë²„ì „ìœ¼ë¡œ ë‚˜ë‰˜ì–´ì ¸ ìˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ í™œìš©í•˜ê³ ì í•˜ëŠ” Github Actions ì™¸ì—ë„ ì¢…ë¥˜ê°€ êµ‰ì¥íˆ ë‹¤ì–‘ (Jenkins, CircleCI, TravisCI ë“±) í•œë°, ì•„ë¬´ë˜ë„ Github Actionsê°€ ì„¤ì¹˜ë‚˜ í° ì„¸íŒ… ì—†ì´ ê°„ë‹¨íˆ í™œìš©í•  ìˆ˜ ìˆì–´ì„œ ê´œì°®ì€ ë“¯ ì‹¶ì–´ ì´ë ‡ê²Œ ì‹œë„í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

### ê¸°ì¡´ ë°°í¬ ë°©ì‹

ê¸°ì¡´ì— Next.jsì™€ Node.jsë¡œ ë§Œë“¤ê³  ìˆëŠ” í”„ë¡œì íŠ¸ëŠ” Oracle Cloud VMì— ëŒì•„ê°€ê³  ìˆê³ , ë°°í¬ ìë™í™” êµ¬ì¶•ì´ ë˜ì–´ ìˆì§€ ì•Šì•„ ì•„ë˜ì™€ ê°™ì€ ì ˆì°¨ë¡œ ë¹Œë“œë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

1. SSHë¡œ OCI ì¸ìŠ¤í„´ìŠ¤ ì ‘ì†
2. í´ë”ë³„ git pull
3. í´ë”ë³„ npm install ë° build
4. ë°°í¬

ì´ëŸ¬í•œ ê³¼ì •ì´ ë³„ê²Œ ì•„ë‹ˆë¼ê³  ìƒê°ì´ ë“¤ ìˆ˜ë„ ìˆì§€ë§Œ, ë°˜ë³µë˜ê³  ì§€ë£¨í•œ ì´ëŸ° ì ˆì°¨ëŠ” ê°œë°œìì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë¹„íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©í•˜ëŠ” ê²ƒì´ë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ Github Actionsë¥¼ í™œìš©í•œ CI/CD êµ¬ì¶•ì„ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

### Github Actionsë¥¼ í™œìš©í•œ CI/CD êµ¬ì¶•

#### SSH ì—°ê²°

ê°€ì¥ ë¨¼ì € SSH ì—°ê²°ì„ í•˜ê¸° ìœ„í•´ [ssh-remote-commands](https://github.com/marketplace/actions/ssh-remote-commands) ë¼ëŠ” actionì„ ì‚¬ìš©í•´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. í•´ë‹¹ í˜ì´ì§€ì—ì„œ ìƒì„¸í•˜ê²Œ ì í˜€ìˆëŠ” ë§¤ë‰´ì–¼ì„ ì°¸ê³ í•˜ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤.

##### ppk file -> rsa ë³€ê²½

![1](https://github.com/ilimes/ilimes/assets/95404736/7c376340-b37d-4c18-8ced-7fa859878b4d)

PuTTY Key Generatorë¡œ ë§Œë“¤ì—ˆë˜ ppk íŒŒì¼ì„ rsa í˜•ì‹ìœ¼ë¡œ ë³€ê²½í•´ì¤ë‹ˆë‹¤.
ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ ê¸°ì¡´ ppk íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¨ ë‹¤ìŒ `Conversions - Export OpenSSH key`ë¥¼ ëˆŒëŸ¬ì£¼ë©´ ë©ë‹ˆë‹¤.

##### secrets ì„¤ì •

ì•”í˜¸í™”ë  ê°’ë“¤ì„ ë„£ì–´ì£¼ëŠ” secretì„ ì„¤ì •í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.  
ë ˆí¬ì§€í† ë¦¬ì˜ ì„¸íŒ…ì—ì„œ `Secrets and variables - Actions` ë¥¼ ëˆŒëŸ¬ì¤ë‹ˆë‹¤.

![image](https://github.com/ilimes/ilimes/assets/95404736/2eb5325a-e8d3-4fad-a2b6-462cdaa8d559)

ê·¸ëŸ¼ ìœ„ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜ì˜µë‹ˆë‹¤. `New repository secret`ë¥¼ ëˆŒëŸ¬ì¤ë‹ˆë‹¤.

![image](https://github.com/ilimes/ilimes/assets/95404736/d29394d3-7111-44ea-bcce-0aa57577aae3)

ê³„ì •ëª…, ì„œë²„ IP, ë¹„ë°€í‚¤, í¬íŠ¸ ë“±ì˜ ì •ë³´ë¥¼ ë§Œë“¤ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.
ì°¸ê³ ë¡œ ë¹„ë°€í‚¤ëŠ” ì•„ê¹Œ ìœ„ì—ì„œ ë§Œë“¤ì—ˆë˜ rsa íŒŒì¼ì˜ ë‚´ìš© ì „ë¶€ë¥¼ ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤. (-----BEGIN OPENSSH PRIVATE KEY-----ì™€ -----END OPENSSH PRIVATE KEY----- ë¥¼ í¬í•¨)

ì‘ì„±í•œ secretsëŠ” {% raw %} ${{secrets.XXX }} {% endraw %} ì´ëŸ°ì‹ìœ¼ë¡œ í‚¤ ê°’ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì œ ì‚¬ì „ ì¤€ë¹„ë¥¼ ë§ˆì³¤ìœ¼ë¯€ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì•¼í•©ë‹ˆë‹¤.

#### Workflow ì‘ì„±

Github ActionsëŠ” í”„ë¡œì íŠ¸ ìµœìƒìœ„ì— ìˆëŠ” .github/workflows í´ë” ì•ˆì— ìˆëŠ” yml ì„ ì½ì–´ì„œ ì‘ë™í•˜ê²Œë” ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì§ì ‘ ì‘ì„±í•´ë„ ë˜ê³  ê¹ƒí—ˆë¸Œ Actions íƒ­ì—ì„œ ì œê³µë˜ëŠ” í…œí”Œë¦¿ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì œ í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì˜ˆì‹œë¡œ ì ì–´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

.github/workflows/deploy.yml

```yaml
name: frontend deploy # workflowì˜ ì´ë¦„
on:
  push:
    branches: ["develop"]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # ëˆ„êµ°ê°€ ë§Œë“¤ì–´ ë†“ì€ Actions í™œìš© ì‹œ uses í‚¤ì›Œë“œ ì‚¬ìš©
      - uses: actions/checkout@v4

      # stepì˜ ì´ë¦„
      - name: Run scripts in server
        uses: appleboy/ssh-action@master
        with:
          host: {% raw %} ${{ secrets.REMOTE_SSH_HOST }} {% endraw %}
          username: {% raw %} ${{ secrets.REMOTE_SSH_USERNAME }} {% endraw %}
          key: {% raw %} ${{ secrets.REMOTE_SSH_KEY  }} {% endraw %}
          port: {% raw %} ${{ secrets.REMOTE_SSH_PORT  }} {% endraw %}
          # ssh ì ‘ì† ì‹¤íŒ¨ íƒ€ì„ì•„ì›ƒ - ë³´í†µ 40ì´ˆëŠ” ì•ˆê±¸ë¦°ë‹¤
          timeout: 40s
          script: |
            whoami
            cd FreeMarket-FE
            sudo git pull origin develop
            # ì•„ë˜ ë‘ ì‘ì—…ì´ ì—†ìœ¼ë©´ pm2ì— ëŒ€í•´ì„œ command not found ì—ëŸ¬ê°€ ëœ° ìˆ˜ ìˆìŒ
            export NVM_DIR=~/.nvm
            source ~/.nvm/nvm.sh
            npm install
            npm run build
            pm2 restart FreeMarket
```

ë§Œì•½ ëª¨ë‘ ì‘ì„±ì„ ì˜ í–ˆëŠ”ë° deploy ë¶€ë¶„ì—ì„œ

```bash
ssh: handshake failed: ssh: unable to authenticate, attempted methods [none publickey], no supported methods remain
```

ìœ„ì™€ ê°™ì€ ì—ëŸ¬ê°€ ëœ¬ë‹¤ë©´ ì„œë²„ì—ì„œ sshd_configê°€ ì˜ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.

/etc/ssh/sshd_config ì—ì„œ

```bash
PubkeyAuthentication yes
PubkeyAcceptedKeyTypes=+ssh-rsa
```

ìœ„ì™€ ê°™ì€ ì½”ë“œ 2ì¤„ì„ ì¶”ê°€í•˜ê³  ssh serverë¥¼ ì¬ì‹œì‘ í•˜ë©´ ë©ë‹ˆë‹¤.

{:.notice--success}
ğŸ””**í¬ìŠ¤íŒ… ê³µì§€**  
ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ ì…ë‹ˆë‹¤.  
ì˜ëª»ëœ ë¶€ë¶„ì´ ìˆì„ ì‹œ ë©”ì¼ì´ë‚˜ ëŒ“ê¸€ë¡œ ì§€ì í•´ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤ :)
